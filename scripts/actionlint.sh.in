#!/usr/bin/env bash

###### script header ######

lib=$(realpath @@BASE_LIB@@) || exit 1
stat "${lib}" >> /dev/null || exit 1

# shellcheck source=../bazel/shell/lib.bash
if ! source "${lib}"; then
  echo "Error: could not find import"
  exit 1
fi

actionlint=$(realpath @@ACTIONLINT@@)
stat "${actionlint}" >> /dev/null
shellcheck=$(realpath @@SHELLCHECK@@ || echo) # might not exist

cd "${BUILD_WORKSPACE_DIRECTORY}"

###### script body ######

# Check if .github/workflows directory exists
if [[ ! -d ".github/workflows" ]]; then
  echo "No .github/workflows directory found, skipping actionlint"
  exit 0
fi

# Check if there are any workflow files
if [[ -z "$(find .github/workflows -name '*.yml' -o -name '*.yaml' 2> /dev/null)" ]]; then
  echo "No workflow files found in .github/workflows, skipping actionlint"
  exit 0
fi

${actionlint} -shellcheck="${shellcheck}"
